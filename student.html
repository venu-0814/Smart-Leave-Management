<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SLMS — Student Dashboard</title>
    <link rel="stylesheet" href="styles/main.css" />
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>

<body>
    <div class="app-layout">

        <!-- Sidebar Overlay (mobile) -->
        <div id="sidebar-overlay" class="sidebar-overlay"></div>

        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-brand">
                <div class="logo"><i data-lucide="graduation-cap" style="width:22px;height:22px;"></i> SLMS</div>
                <div class="tagline">Student Portal</div>
            </div>
            <div class="sidebar-nav">
                <div class="nav-section-label">Navigation</div>
                <button class="nav-item active" onclick="showSection('dashboard')" id="nav-dashboard">
                    <span class="icon"><i data-lucide="layout-dashboard"></i></span> Dashboard
                </button>
                <button class="nav-item" onclick="showSection('apply')" id="nav-apply">
                    <span class="icon"><i data-lucide="file-plus"></i></span> Apply Leave
                </button>
                <button class="nav-item" onclick="showSection('history')" id="nav-history">
                    <span class="icon"><i data-lucide="clock"></i></span> Leave History
                </button>
            </div>
            <div class="sidebar-footer">
                <div class="user-chip">
                    <div class="avatar" id="avatar-initials">?</div>
                    <div class="user-info">
                        <div class="name" id="sidebar-name">Loading…</div>
                        <div class="role">Student</div>
                    </div>
                </div>
                <button class="btn btn-ghost btn-sm" onclick="logout()"
                    style="width:100%;margin-top:10px;justify-content:center;">
                    <i data-lucide="log-out" style="width:14px;height:14px;"></i> Logout
                </button>
            </div>
        </nav>

        <!-- Topbar -->
        <header class="topbar">
            <div style="display:flex;align-items:center;gap:12px;">
                <button class="hamburger-btn" id="hamburger-btn">
                    <i data-lucide="menu"></i>
                </button>
                <div class="topbar-title" id="topbar-title">Student Dashboard</div>
            </div>
            <div class="topbar-actions">
                <div class="topbar-search">
                    <i data-lucide="search"></i>
                    <input type="text" placeholder="Search…" />
                </div>
                <span id="topbar-att" style="font-size:13px;font-weight:600;"></span>
                <div class="topbar-profile" id="topbar-profile-btn">
                    <div class="avatar" style="width:30px;height:30px;font-size:11px;" id="topbar-avatar">?</div>
                    <span class="profile-name" id="topbar-profile-name">Student</span>
                    <span class="profile-chevron"><i data-lucide="chevron-down"></i></span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">

            <!-- ═══ SECTION: Dashboard ═════════════════ -->
            <div id="section-dashboard" class="section-animate">
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:24px;" id="overview-grid">

                    <!-- Attendance Card -->
                    <div class="card card-padded"
                        style="display:flex;flex-direction:column;align-items:center;gap:16px;justify-content:center;min-height:220px;">
                        <div class="att-ring-wrapper">
                            <div class="att-ring-container">
                                <canvas id="att-ring" width="140" height="140"></canvas>
                            </div>
                            <div class="att-percent-label" id="att-percent">—</div>
                            <div class="att-status-label" id="att-status">Loading…</div>
                        </div>
                        <div style="text-align:center;">
                            <small>Today's Attendance Status</small>
                        </div>
                    </div>

                    <!-- Leave Summary Card -->
                    <div class="card card-padded" style="display:flex;flex-direction:column;gap:16px;">
                        <h4>Leave Summary</h4>
                        <div class="stats-grid" style="grid-template-columns:1fr 1fr;gap:12px;">
                            <div class="stat-card" style="padding:16px;">
                                <div class="stat-icon"><i data-lucide="calendar-days"
                                        style="width:24px;height:24px;color:var(--accent-blue);"></i></div>
                                <div class="stat-value" id="leaves-used">—</div>
                                <div class="stat-label">Used This Month</div>
                            </div>
                            <div class="stat-card" style="padding:16px;">
                                <div class="stat-icon"><i data-lucide="check-circle"
                                        style="width:24px;height:24px;color:var(--accent-green);"></i></div>
                                <div class="stat-value" id="leaves-remaining">—</div>
                                <div class="stat-label">Remaining</div>
                            </div>
                        </div>
                        <div style="height:6px;background:var(--bg-secondary);border-radius:99px;overflow:hidden;">
                            <div id="leave-progress"
                                style="height:100%;border-radius:99px;background:var(--accent-blue);transition:width 0.8s ease;width:0%">
                            </div>
                        </div>
                        <small>Max 4 leaves per month</small>
                    </div>
                </div>

                <!-- Blocked Banner (shown if att < 75%) -->
                <div id="blocked-banner" class="blocked-banner" style="display:none;margin-bottom:20px;">
                    <div class="blocked-icon"><i data-lucide="shield-x"
                            style="width:32px;height:32px;color:var(--accent-red);"></i></div>
                    <div>
                        <div class="blocked-title">Leave Application Disabled</div>
                        <div class="blocked-desc">Your attendance is below 75%. Online leave applications are disabled.
                            Please submit a <strong>physical letter</strong> to your faculty/mentor directly.</div>
                    </div>
                </div>

                <!-- Profile Info -->
                <div class="card card-padded">
                    <div class="section-title" style="margin-bottom:16px;"><span class="dot"></span> My Profile</div>
                    <div id="profile-grid"
                        style="display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px;">
                        <div style="color:var(--text-muted);font-size:13px;">Loading profile…</div>
                    </div>
                </div>
            </div>

            <!-- ═══ SECTION: Apply Leave ══════════════ -->
            <div id="section-apply" style="display:none;">
                <div id="apply-blocked-msg" class="blocked-banner" style="display:none;margin-bottom:20px;">
                    <div class="blocked-icon"><i data-lucide="shield-x"
                            style="width:32px;height:32px;color:var(--accent-red);"></i></div>
                    <div>
                        <div class="blocked-title">Cannot Apply Online</div>
                        <div class="blocked-desc" id="apply-blocked-reason">Your attendance is too low.</div>
                    </div>
                </div>

                <div class="card card-padded" id="apply-form-card">
                    <div class="section-title" style="margin-bottom:20px;"><span class="dot"></span> Apply for Leave
                    </div>
                    <form id="leave-form" onsubmit="submitLeave(event)">
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;" class="form-grid-2">
                            <div class="form-group">
                                <label class="form-label">From Date</label>
                                <input type="date" id="from-date" class="form-input" required />
                            </div>
                            <div class="form-group">
                                <label class="form-label">To Date</label>
                                <input type="date" id="to-date" class="form-input" required />
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Leave Type</label>
                            <select id="leave-type" class="form-select">
                                <option value="personal">Personal</option>
                                <option value="medical">Medical</option>
                                <option value="family">Family</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Reason</label>
                            <textarea id="reason" class="form-textarea"
                                placeholder="Briefly describe your reason for leave…" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary" id="apply-btn">
                            <i data-lucide="send" style="width:16px;height:16px;"></i> Submit Leave Request
                        </button>
                    </form>
                </div>
            </div>

            <!-- ═══ SECTION: Leave History ════════════ -->
            <div id="section-history" style="display:none;">
                <div class="card">
                    <div class="section-header" style="padding:20px 20px 0;">
                        <div class="section-title"><span class="dot"></span> Leave History</div>
                    </div>

                    <!-- Desktop Table -->
                    <div class="table-wrapper desktop-only"
                        style="margin-top:16px;border:none;border-top:1px solid var(--border);border-radius:0 0 var(--radius-lg) var(--radius-lg);">
                        <table>
                            <thead>
                                <tr>
                                    <th>From</th>
                                    <th>To</th>
                                    <th>Type</th>
                                    <th>Reason</th>
                                    <th>Status</th>
                                    <th>Applied</th>
                                </tr>
                            </thead>
                            <tbody id="history-body">
                                <tr>
                                    <td colspan="6">
                                        <div class="loading-state">
                                            <div class="spinner"></div> Loading…
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Mobile Cards -->
                    <div class="mobile-cards-container" id="history-cards-mobile">
                        <div class="loading-state">
                            <div class="spinner"></div> Loading…
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- Bottom Tab Bar (Mobile) -->
    <nav class="bottom-tab-bar">
        <div class="bottom-tab-bar-inner">
            <button class="bottom-tab active" data-section="dashboard">
                <i data-lucide="layout-dashboard"></i>
                <span>Dashboard</span>
            </button>
            <button class="bottom-tab" data-section="apply">
                <i data-lucide="file-plus"></i>
                <span>Apply</span>
            </button>
            <button class="bottom-tab" data-section="history">
                <i data-lucide="clock"></i>
                <span>History</span>
            </button>
        </div>
    </nav>

    <div id="toast-container"></div>
    <script src="js/api.js"></script>
    <script src="js/student.js"></script>
</body>

</html>